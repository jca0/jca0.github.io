<!DOCTYPE html>
<html>
<head>
  <title>Calendar</title>
</head>
<body>
  <h1>Calendar</h1>
  <div id="event-list"></div>

  <h2>Add Event</h2>
  <form id="event-form">
    <input type="text" name="title" placeholder="Title" required /><br />
    <textarea name="description" placeholder="Description"></textarea><br />
    <label>Start Time: <input type="datetime-local" name="startTime" required /></label><br />
    <label>End Time: <input type="datetime-local" name="endTime" required /></label><br />
    <button type="submit">Add Event</button>
  </form>

  <script>
    const calendarId = window.location.pathname.split('/').pop();

    async function loadEvents() {
      const response = await fetch(`/api/calendar/${calendarId}/events`);
      const events = await response.json();
      const eventList = document.getElementById('event-list');
      eventList.innerHTML = '';
      events.forEach(event => {
        const eventDiv = document.createElement('div');
        eventDiv.innerHTML = `
          <h3>${event.title}</h3>
          <p>${event.description}</p>
          <p>From: ${new Date(event.startTime).toLocaleString()}</p>
          <p>To: ${new Date(event.endTime).toLocaleString()}</p>
          <button onclick="deleteEvent('${event._id}')">Delete</button>
          <hr />
        `;
        eventList.appendChild(eventDiv);
      });
    }

    async function deleteEvent(eventId) {
      await fetch(`/api/calendar/${calendarId}/events/${eventId}`, { method: 'DELETE' });
      loadEvents();
    }

    document.getElementById('event-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const eventData = Object.fromEntries(formData.entries());
      eventData.startTime = new Date(eventData.startTime).toISOString();
      eventData.endTime = new Date(eventData.endTime).toISOString();

      await fetch(`/api/calendar/${calendarId}/events`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(eventData),
      });
      e.target.reset();
      loadEvents();
    });

    loadEvents();
  </script>
</body>
</html>

